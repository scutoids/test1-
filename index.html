<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR 二项分布 (iPhone 优化)</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    .info {
      position: absolute; top: 10px; left: 10px; color: #fff;
      background: rgba(0,0,0,0.7); padding: 8px 12px; border-radius: 6px;
      font-family: -apple-system, sans-serif; font-size: 14px; z-index: 100;
    }
  </style>
</head>
<body>

<div class="info">加载中… 模型即将出现在你面前</div>

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  renderer="logarithmicDepthBuffer: true"
  arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
  location-based
>

  <!-- 模型固定在相机前方 1.5 米，地面上 -->
  <a-entity id="modelGroup" position="0 0 -1.5" rotation="0 0 0"></a-entity>

  <a-camera></a-camera>
</a-scene>

<script>
  // ========== 二项分布 ==========
  function C(n, k) {
    if (k < 0 || k > n) return 0;
    let res = 1;
    for (let i = 1; i <= k; ++i) res = res * (n - i + 1) / i;
    return res;
  }

  function binomialData(n, p) {
    const data = [];
    for (let k = 0; k <= n; ++k) {
      const pk = C(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
      data.push({ k, pk });
    }
    return data;
  }

  // ========== 参数 ==========
  const n = 10, p = 0.5;
  const data = binomialData(n, p);

  const BAR_WIDTH = 0.12;
  const SPACING   = 0.18;
  const SCALE_Y   = 8;

  // ========== 创建模型 ==========
  const scene = document.querySelector('#modelGroup');

  data.forEach(d => {
    const height = d.pk * SCALE_Y;
    const xPos   = (d.k - n/2) * SPACING;

    const bar = document.createElement('a-box');
    bar.setAttribute('width', BAR_WIDTH);
    bar.setAttribute('depth', BAR_WIDTH);
    bar.setAttribute('height', height);
    bar.setAttribute('position', `${xPos} ${height/2} 0`);
    bar.setAttribute('color', '#4a90e2');
    bar.setAttribute('shadow', 'cast: true; receive: true');
    bar.setAttribute('class', 'clickable');
    bar.setAttribute('data-k', d.k);
    bar.setAttribute('data-pk', d.pk.toFixed(4));
    scene.appendChild(bar);

    // 标签
    const label = document.createElement('a-text');
    label.setAttribute('value', d.k.toString());
    label.setAttribute('align', 'center');
    label.setAttribute('color', '#fff');
    label.setAttribute('position', `${xPos} -0.05 0`);
    label.setAttribute('rotation', '-90 0 0');
    label.setAttribute('scale', '0.5 0.5 0.5');
    scene.appendChild(label);
  });

  // 地面
  const ground = document.createElement('a-plane');
  ground.setAttribute('width', 3);
  ground.setAttribute('depth', 1.5);
  ground.setAttribute('position', '0 -0.01 0');
  ground.setAttribute('rotation', '-90 0 0');
  ground.setAttribute('color', '#2c3e50');
  ground.setAttribute('opacity', '0.7');
  scene.appendChild(ground);

  // 灯光
  scene.appendChild(Object.assign(document.createElement('a-light'), { type: 'ambient', color: '#ccc' }));
  scene.appendChild(Object.assign(document.createElement('a-light'), { type: 'directional', position: '2 4 2', intensity: '0.8' }));

  // 点击
  document.querySelectorAll('.clickable').forEach(el => {
    el.addEventListener('click', () => {
      const k = el.getAttribute('data-k');
      const pk = el.getAttribute('data-pk');
      alert(`P(X = ${k}) = ${pk}`);
    });
  });

  // 提示
  setTimeout(() => {
    document.querySelector('.info').innerHTML = '成功！<br>11 根柱体在你面前<br>点击查看概率';
  }, 1500);

</script>
</body>
</html>
